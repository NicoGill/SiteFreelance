(function(e){"use strict";function s(e,t){e.style.WebkitTransform=t;e.style.msTransform=t;e.style.transform=t}function o(){var n=t["clientWidth"],r=e["innerWidth"];if(n<r)return r;else return n}function u(e,t){for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}return e}function a(e,t){this.el=e;this.options=u({},this.options);u(this.options,t);this._init()}var t=e.document.documentElement,n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},r=n[Modernizr.prefixed("transition")],i={transitions:Modernizr.csstransitions,support3d:Modernizr.csstransforms3d};a.prototype.options={};a.prototype._init=function(){this.grid=this.el.querySelector("section.grid-wrap > ul.grid");this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)"));this.itemsCount=this.gridItems.length;this.slideshow=this.el.querySelector("section.slideshow > ul");this.slideshowItems=[].slice.call(this.slideshow.children);this.current=-1;this.ctrlPrev=this.el.querySelector("section.slideshow > nav > span.nav-prev");this.ctrlNext=this.el.querySelector("section.slideshow > nav > span.nav-next");this.ctrlClose=this.el.querySelector("section.slideshow > nav > span.nav-close");this._initMasonry();this._initEvents()};a.prototype._initMasonry=function(){var e=this.grid;imagesLoaded(e,function(){new Masonry(e,{itemSelector:"li",columnWidth:e.querySelector(".grid-sizer")})})};a.prototype._initEvents=function(){var n=this;this.gridItems.forEach(function(e,t){e.addEventListener("click",function(){n._openSlideshow(t)})});this.ctrlPrev.addEventListener("click",function(){n._navigate("prev")});this.ctrlNext.addEventListener("click",function(){n._navigate("next")});this.ctrlClose.addEventListener("click",function(){n._closeSlideshow()});e.addEventListener("resize",function(){n._resizeHandler()});document.addEventListener("keydown",function(e){if(n.isSlideshowVisible){var t=e.keyCode||e.which;switch(t){case 37:n._navigate("prev");break;case 39:n._navigate("next");break;case 27:n._closeSlideshow();break}}});e.addEventListener("scroll",function(){if(n.isSlideshowVisible){e.scrollTo(n.scrollPosition?n.scrollPosition.x:0,n.scrollPosition?n.scrollPosition.y:0)}else{n.scrollPosition={x:e.pageXOffset||t.scrollLeft,y:e.pageYOffset||t.scrollTop}}})};a.prototype._openSlideshow=function(e){this.isSlideshowVisible=true;this.current=e;classie.addClass(this.el,"slideshow-open");this._setViewportItems();classie.addClass(this.currentItem,"current");classie.addClass(this.currentItem,"show");if(this.prevItem){classie.addClass(this.prevItem,"show");var t=Number(-1*(o()/2+this.prevItem.offsetWidth/2));s(this.prevItem,i.support3d?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");var t=Number(o()/2+this.nextItem.offsetWidth/2);s(this.nextItem,i.support3d?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}};a.prototype._navigate=function(e){if(this.isAnimating)return;if(e==="next"&&this.current===this.itemsCount-1||e==="prev"&&this.current===0){this._closeSlideshow();return}this.isAnimating=true;this._setViewportItems();var t=this,n=this.currentItem.offsetWidth,u=i.support3d?"translate3d(-"+Number(o()/2+n/2)+"px, 0, -150px)":"translate(-"+Number(o()/2+n/2)+"px)",a=i.support3d?"translate3d("+Number(o()/2+n/2)+"px, 0, -150px)":"translate("+Number(o()/2+n/2)+"px)",f="",l,c,h;if(e==="next"){l=i.support3d?"translate3d( -"+Number(o()*2/2+n/2)+"px, 0, -150px )":"translate(-"+Number(o()*2/2+n/2)+"px)";c=i.support3d?"translate3d( "+Number(o()*2/2+n/2)+"px, 0, -150px )":"translate("+Number(o()*2/2+n/2)+"px)"}else{l=i.support3d?"translate3d( "+Number(o()*2/2+n/2)+"px, 0, -150px )":"translate("+Number(o()*2/2+n/2)+"px)";c=i.support3d?"translate3d( -"+Number(o()*2/2+n/2)+"px, 0, -150px )":"translate(-"+Number(o()*2/2+n/2)+"px)"}classie.removeClass(t.slideshow,"animatable");if(e==="next"&&this.current<this.itemsCount-2||e==="prev"&&this.current>1){h=this.slideshowItems[e==="next"?this.current+2:this.current-2];s(h,c);classie.addClass(h,"show")}var p=function(){classie.addClass(t.slideshow,"animatable");classie.removeClass(t.currentItem,"current");var n=e==="next"?t.nextItem:t.prevItem;classie.addClass(n,"current");s(t.currentItem,e==="next"?u:a);if(t.nextItem){s(t.nextItem,e==="next"?f:l)}if(t.prevItem){s(t.prevItem,e==="next"?l:f)}if(h){s(h,e==="next"?a:u)}var o=function(n){if(i.transitions){if(n.propertyName.indexOf("transform")===-1)return false;this.removeEventListener(r,o)}if(t.prevItem&&e==="next"){classie.removeClass(t.prevItem,"show")}else if(t.nextItem&&e==="prev"){classie.removeClass(t.nextItem,"show")}if(e==="next"){t.prevItem=t.currentItem;t.currentItem=t.nextItem;if(h){t.nextItem=h}}else{t.nextItem=t.currentItem;t.currentItem=t.prevItem;if(h){t.prevItem=h}}t.current=e==="next"?t.current+1:t.current-1;t.isAnimating=false};if(i.transitions){t.currentItem.addEventListener(r,o)}else{o()}};setTimeout(p,25)};a.prototype._closeSlideshow=function(e){classie.removeClass(this.el,"slideshow-open");classie.removeClass(this.slideshow,"animatable");var t=this,n=function(e){if(i.transitions){if(e.target.tagName.toLowerCase()!=="ul")return;this.removeEventListener(r,n)}classie.removeClass(t.currentItem,"current");classie.removeClass(t.currentItem,"show");if(t.prevItem){classie.removeClass(t.prevItem,"show")}if(t.nextItem){classie.removeClass(t.nextItem,"show")}t.slideshowItems.forEach(function(e){s(e,"")});t.isSlideshowVisible=false};if(i.transitions){this.el.addEventListener(r,n)}else{n()}};a.prototype._setViewportItems=function(){this.currentItem=null;this.prevItem=null;this.nextItem=null;if(this.current>0){this.prevItem=this.slideshowItems[this.current-1]}if(this.current<this.itemsCount-1){this.nextItem=this.slideshowItems[this.current+1]}this.currentItem=this.slideshowItems[this.current]};a.prototype._resizeHandler=function(){function t(){e._resize();e._resizeTimeout=null}var e=this;if(this._resizeTimeout){clearTimeout(this._resizeTimeout)}this._resizeTimeout=setTimeout(t,50)};a.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var e=Number(-1*(o()/2+this.prevItem.offsetWidth/2));s(this.prevItem,i.support3d?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}if(this.nextItem){var e=Number(o()/2+this.nextItem.offsetWidth/2);s(this.nextItem,i.support3d?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}}};e.CBPGridGallery=a})(window)